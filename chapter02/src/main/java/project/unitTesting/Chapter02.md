# Chapter 02: 단위 테스트란 무엇인가

## '단위 테스트'의 정의
1. 작은 코드 조각을 검증한다.
2. 빠르게 수행한다.
3. 격리된 방식으로 처리하는 자동화된 테스트이다.

### 코드 조각(단위)을 격리된 방식으로 검증한다는 것(런던파)?
- 하나의 클래스가 다른 클래스 또는 여러 클래스에 의존한다면, 이 모든 의존성을 **테스트 대역(test double)**으로 대체한다.

## 장점
1. **테스트 실패 시, 원인 파악이 용이**
   - 테스트가 실패하면 코드베이스의 어느 부분이 고장 났는지 확실히 알 수 있다.
2. **객체 그래프를 분할**
   - 객체 간의 복잡한 의존성을 분리하여 테스트를 간소화한다.

---

## 협력자를 대체하지 않고 운영용 인스턴스를 사용하는 고전적인 방식의 특징
- SUT(System Under Test, 테스트 대상 시스템)와 협력자 둘 다 효과적으로 검증할 수 있다.
- SUT가 올바르게 작동하더라도, 협력자 내부의 버그로 인해 단위 테스트가 실패할 수 있다.

---

## 격리 문제에 대한 고전파의 접근
1. 테스트 간에 공유 상태에 도달하지 않는 한, 여러 클래스를 한 번에 테스트해도 괜찮다.
2. 테스트 대역은 주로 **공유 상태를 일으키는 의존성**에 대해서만 사용한다.
3. 공유 의존성은 대부분 실행 프로세스 외부에 있기 때문에 실행 시간이 오래 걸린다.
   - 실행 시간이 오래 걸리는 테스트는 단위 테스트에서 통합 테스트로 넘어간다.

---

## 단위 테스트의 런던파와 고전파
### 정의
- **런던파**: 테스트 대상 시스템에서 협력자를 격리하는 것으로 본다.
- **고전파**: 단위 테스트끼리 격리하는 것으로 본다.

### 협력자란?
- **공유하거나 변경 가능한 의존성**이다. 불변 객체나 값은 협력자가 아니다.

---

## 고전파와 런던파 비교
### 런던파 방식의 장점
1. **입자성이 좋다**
   - 테스트가 세밀해서 한 번에 한 클래스만 확인한다.
   - 하지만 클래스를 테스트의 원자 단위로 취급하면, 테스트가 무엇을 검증하는지 이해하기 어려워질 수 있다.
   - 테스트는 **클래스가 아닌 단일 동작 단위**를 검증해야 한다.

2. **서로 연결된 클래스의 그래프가 커져도 테스트하기 쉽다**
   - 그러나, 이러한 클래스 그래프를 갖지 않도록 설계를 개선하는 것이 중요하다.
   - 클래스 그래프가 커진 것은 코드 설계 문제의 결과일 가능성이 높다.

3. **버그 위치를 정확히 찾아낸다**
   - 고전파 방식에서도 테스트를 정기적으로 실행하면 버그의 원인을 파악할 수 있다.
   - 또한, 많은 테스트가 동일한 결함을 드러낸다면 해당 코드 조각이 중요함을 알 수 있다.

---

## 두 분파의 통합 테스트
1. **런던파**:
   - 실제 협력자 객체를 사용하는 모든 테스트를 통합 테스트로 간주한다.
2. **고전파**:
   - 단위 테스트 기준 중 하나라도 충족하지 않는 테스트를 통합 테스트로 간주한다.

### 올바른 단위 테스트 기준
1. 단일 동작 단위를 검증한다.
2. 빠르게 수행된다.
3. 다른 테스트와 별개로 처리된다.
