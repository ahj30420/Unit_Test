# Chapter 05: 목과 테스트 취약성

---

## 테스트 대역 유형
1. **목(Mock, Spy)**  
   - 외부로 나가는 상호 작용을 모방하고 검증하는 데 도움을 줌.

2. **스텁(Stub, Dummy, Fake)**  
   - 내부로 들어오는 상호 작용을 모방하는 데 도움을 줌.

---

## 스텁으로 상호 작용을 검증하지 말라
- **스텁**: 최종 결과를 산출하기 위한 수단일 뿐 최종 결과 자체는 아님.
- 스텁과의 상호 작용을 검증하는 것은 테스트를 취약하게 만드는 일반적인 **안티패턴**임.

---

## 과잉 명세
- **정의**: 최종 결과가 아닌 사항을 검증하는 관행.
- **주요 특징**:
  - 상호 작용을 과도하게 검사할 때 주로 발생.
  - **테스트 취약성**의 주요 원인이 됨.

---

## 목과 스텁의 명령과 조회와의 관계

### CQS(Command Query Separation)
- **원칙**: 모든 메서드는 **명령(Command)**이거나 **조회(Query)**여야 하며, 둘을 혼용해서는 안 됨.
  1. **명령**:  
     - 사이드 이펙트를 일으키며, 값을 반환하지 않음.  
     - 예: 객체 상태 변경, 파일 수정 등.
  2. **조회**:  
     - 사이드 이펙트 없이 값을 반환.

- **목(Mock)**: 명령을 대체하는 테스트 대역.  
- **스텁(Stub)**: 조회를 대체하는 테스트 대역.

---

## 식별할 수 있는 동작의 특징
1. **클라이언트가 목표를 달성하는 데 도움을 주는 연산 노출**.
2. **클라이언트가 목표를 달성하는 데 도움을 주는 상태 노출**.

- 식별할 수 있는 동작은 위 두 가지 중 하나를 충족해야 하며,  
  구현 세부 사항은 이 두 가지 중 아무것도 하지 않음.

---

## 구현 세부 사항 유출 방지
- 단일 목표를 달성하기 위해 클래스에서 호출해야 하는 연산의 수가 1보다 크면,  
  해당 클래스에서 구현 세부 사항이 유출될 가능성이 있음.
- 모든 구현 세부 사항을 비공개로 하면 테스트는 식별할 수 있는 동작을 검증할 수밖에 없으며,  
  이로 인해 **리팩터링 내성**이 자동으로 향상됨.

---

## 육각형 아키텍처의 세 가지 관점
1. **도메인과 애플리케이션 서비스 계층 간의 영향 분리**  
   - 도메인 계층: 비즈니스 로직 책임.  
   - 애플리케이션 서비스 계층: 도메인 계층과 외부 애플리케이션 간의 작업 조정.

2. **애플리케이션 서비스 계층에서 도메인 계층으로의 단방향 의존성 흐름**

3. **외부 애플리케이션은 애플리케이션 서비스 계층의 공통 인터페이스를 통해 연결됨**  
   - 외부 애플리케이션이 도메인 계층에 직접 접근하지 않음.

---

## 애플리케이션의 두 가지 통신 유형
1. **시스템 내 통신**  
   - 구현 세부 사항이며, 목을 사용해 이를 검증하면 **취약한 테스트**로 이어짐.

2. **시스템 간 통신**  
   - 시스템 외부와의 상호 작용을 포함하며, 이와 관련된 테스트는 목을 활용하는 것이 유용.

---
