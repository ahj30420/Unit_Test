# Chapter 07: 가치 있는 단위 테스트를 위한 리팩터링

---

## 도메인 유의성과 회귀 방지
- **도메인 유의성**은 프로젝트의 문제 도메인에서 코드가 얼마나 중요한지를 나타냄.
- **복잡한 코드**와 도메인 유의성을 가진 코드는 회귀 방지가 뛰어나므로 단위 테스트에서 가장 유용함.
- 협력자가 많은 코드를 다루는 단위 테스트는 **유지 비용이 많이 듦**.

---

## 코드의 네 가지 유형
모든 제품 코드는 **복잡도** 또는 **도메인 유의성**과 협력자 수에 따라 다음 네 가지로 분류 가능:
1. **도메인 모델 및 알고리즘**:
   - 노력 대비 가장 이로움.
2. **간단한 코드**:
   - 유지보수가 용이함.
3. **컨트롤러**:
   - 외부와 상호작용하는 역할.
4. **지나치게 복잡한 코드**:
   - 컨트롤러와 복잡한 코드로 분리 필요.

---

## 코드 복잡도와 협력자
- 코드가 중요하거나 복잡할수록 협력자가 적어야 유지보수성 향상.

---

## 비즈니스 로직과 오케스트레이션 분리
비즈니스 로직과 오케스트레이션 분리를 고려할 때 중요한 세 가지 특징:
1. **도메인 모델 테스트 유의성**:
   - 테스트가 도메인 모델의 논리를 정확히 검증 가능.
2. **컨트롤러 단순성**:
   - 컨트롤러는 복잡성을 최소화해야 함.
3. **성능**:
   - 성능 저하는 최소화해야 함.

---

## 세 가지 특징의 조합
### 최대 두 가지 특징을 선택 가능:
1. **외부에 대한 모든 읽기와 쓰기를 비즈니스 연산 가장자리로 밀어내기**:
   - 컨트롤러를 단순하게 유지.
   - 도메인 모델 테스트 유의성을 유지.
   - **단점**: 성능 저하.

2. **도메인 모델에 프로세스 외부 의존성을 주입하기**:
   - 성능 유지.
   - 컨트롤러 단순성 유지.
   - **단점**: 도메인 모델 테스트 유의성 저하.

3. **의사 결정 프로세스 단계를 더 세분화하기**:
   - 성능 유지.
   - 도메인 모델 테스트 유의성 유지.
   - **단점**: 컨트롤러 단순성 포기.

---

## 최적의 선택: 의사 결정 프로세스 세분화
의사 결정 프로세스를 세분화하는 것이 장단점을 고려할 때 가장 효과적:
- **CanExecute/Execute 패턴**:
  - 특정 조건에서 실행 가능 여부를 확인 후 작업 수행.
- **도메인 이벤트**:
  - 도메인 모델의 중요한 변경 사항을 추적.
  - 해당 변경 사항을 프로세스 외부 의존성 호출로 변환.

---
